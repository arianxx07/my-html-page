<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸‰å¹´(4)ç­ç§¯åˆ†ç³»ç»Ÿ</title>
  <style>
    body {
      background-color: #d6eaff;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    h1 {
      font-size: 24px;
    }
    .menu {
      margin: 20px auto;
    }
    .menu button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .student-card {
      width: 150px;
      border: 2px solid #000;
      border-radius: 10px;
      margin: 10px;
      padding: 10px;
      background-color: #fff;
      cursor: move;
      position: relative;
    }
    .student-name {
      font-size: 18px;
      font-weight: bold;
    }
    .student-score {
      font-size: 20px;
      color: red;
      margin: 10px 0;
      transition: transform 0.2s;
    }
    .btn {
      padding: 5px 10px;
      font-size: 18px;
    }
    /* ç”¨äºç§¯åˆ†å˜åŒ–çš„åŠ¨ç”»æ•ˆæœ */
    .bump {
      transform: scale(1.2);
    }
  </style>
</head>
<body>
  <h1>ä¸‰å¹´(4)ç­ç§¯åˆ†ç³»ç»Ÿ ğŸ˜Š</h1>
  <div class="menu">
    <button onclick="adjustAllScores()">å…¨ç­åŠ åˆ†</button>
    <button onclick="resetScores()">å…¨ç­æ¸…é›¶</button>
    <button onclick="showRanking()">æ’è¡Œæ¦œ</button>
    <button onclick="importScores()">å¯¼å…¥ç§¯åˆ†</button>
    <button onclick="exportScores()">å¯¼å‡ºç§¯åˆ†</button>
    <button onclick="addStudent()">æ·»åŠ å­¦ç”Ÿ</button>
  </div>
  <div class="grid" id="studentGrid"></div>
  <script>
    // ä»æµè§ˆå™¨localStorageä¸­è·å–æ•°æ®ï¼Œè‹¥æ²¡æœ‰åˆ™åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
    let students = JSON.parse(localStorage.getItem('students')) || [];
    // ä¿å­˜æ‹–æ‹½æ—¶çš„æºç´¢å¼•
    let dragSrcIndex = null;

    function renderStudents() {
      const grid = document.getElementById('studentGrid');
      grid.innerHTML = '';
      students.forEach((student, index) => {
        const card = document.createElement('div');
        card.className = 'student-card';
        card.setAttribute('draggable', 'true');
        card.innerHTML = `
          <div class="student-name">${student.name}</div>
          <div class="student-score" id="score-${index}">${student.score}</div>
          <button class="btn" onclick="changeScore(${index}, -1)">â–</button>
          <button class="btn" onclick="changeScore(${index}, 1)">â•</button>
        `;
        // æ·»åŠ æ‹–æ‹½äº‹ä»¶
        card.addEventListener('dragstart', (e) => {
          dragSrcIndex = index;
          e.dataTransfer.effectAllowed = 'move';
        });
        card.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        });
        card.addEventListener('drop', (e) => {
          e.preventDefault();
          if (dragSrcIndex === null) return;
          // é‡æ–°æ’åˆ—æ•°ç»„é¡ºåº
          const draggedStudent = students.splice(dragSrcIndex, 1)[0];
          students.splice(index, 0, draggedStudent);
          saveAndRender();
          dragSrcIndex = null;
        });
        // å³é”®åˆ é™¤åŠŸèƒ½ï¼šå³é”®ç‚¹å‡»å­¦ç”Ÿå¡ç‰‡å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
        card.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          if (confirm(`ç¡®è®¤åˆ é™¤å­¦ç”Ÿ: ${student.name}ï¼Ÿ`)) {
            students.splice(index, 1);
            saveAndRender();
          }
        });
        grid.appendChild(card);
      });
    }

    // è°ƒæ•´å•ä¸ªå­¦ç”Ÿç§¯åˆ†ï¼Œå¹¶æ·»åŠ åŠ¨ç”»æ•ˆæœ
    function changeScore(index, amount) {
      students[index].score += amount;
      saveAndRender();
      const scoreElem = document.getElementById(`score-${index}`);
      if (scoreElem) {
        scoreElem.classList.add('bump');
        setTimeout(() => scoreElem.classList.remove('bump'), 200);
      }
    }

    // å…¨ç­åŠ åˆ†/æ‰£åˆ†
    function adjustAllScores() {
      let value = parseInt(prompt("è¾“å…¥åŠ åˆ†æˆ–æ‰£åˆ†æ•°(å¯ä¸ºè´Ÿ):"));
      if (!isNaN(value)) {
        students.forEach(s => s.score += value);
        saveAndRender();
      }
    }

    // å…¨ç­ç§¯åˆ†æ¸…é›¶
    function resetScores() {
      if (confirm("ç¡®è®¤æ¸…é›¶æ‰€æœ‰ç§¯åˆ†ï¼Ÿ")) {
        students.forEach(s => s.score = 0);
        saveAndRender();
      }
    }

    // æ˜¾ç¤ºæ’è¡Œæ¦œï¼Œå‰ä¸‰åé™„å¸¦é‡‘ã€é“¶ã€é“œç‰Œè¡¨æƒ…
    function showRanking() {
      let ranking = students.slice().sort((a, b) => b.score - a.score);
      let output = ranking.map((s, i) => {
        let medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : '';
        return `${medal} ${s.name}: ${s.score}`;
      }).join('\n');
      alert(output || "æš‚æ— æ•°æ®");
    }

    // æ·»åŠ æ–°å­¦ç”Ÿï¼Œé»˜è®¤ç§¯åˆ†ä¸º0ï¼Œæ¸²æŸ“åœ¨æœ€å‰é¢
    function addStudent() {
      let name = prompt("è¾“å…¥å­¦ç”Ÿå§“å:");
      if (name) {
        students.unshift({ name, score: 0 });
        saveAndRender();
      }
    }

    // å¯¼å…¥ç§¯åˆ†ï¼Œä»txtæ–‡ä»¶ä¸­è¯»å–æ ¼å¼ä¸ºâ€œå­¦ç”Ÿå§“å,ç§¯åˆ†â€çš„æ•°æ®
    function importScores() {
      let input = document.createElement('input');
      input.type = 'file';
      input.accept = '.txt';
      input.addEventListener('change', function () {
        let file = input.files[0];
        let reader = new FileReader();
        reader.onload = function (e) {
          let lines = e.target.result.split('\n');
          students = lines.map(line => {
            let [name, score] = line.split(',');
            return { name: name.trim(), score: parseInt(score) || 0 };
          }).filter(s => s.name);
          saveAndRender();
        };
        reader.readAsText(file);
      });
      input.click();
    }

    // å¯¼å‡ºç§¯åˆ†ï¼Œå°†å½“å‰æ‰€æœ‰å­¦ç”Ÿç§¯åˆ†ä»¥txtæ–‡ä»¶æ ¼å¼å¯¼å‡º
    function exportScores() {
      let content = students.map(s => `${s.name},${s.score}`).join('\n');
      let blob = new Blob([content], { type: 'text/plain' });
      let link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'ç§¯åˆ†æ•°æ®.txt';
      link.click();
    }

    // ä¿å­˜æ•°æ®åˆ°localStorageå¹¶é‡æ–°æ¸²æŸ“
    function saveAndRender() {
      localStorage.setItem('students', JSON.stringify(students));
      renderStudents();
    }

    renderStudents();
  </script>
</body>
</html>
